<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¹Ù„Ù… - Ø³Ø§Ù…Ø§Ù†Ù‡ Ø¢Ø²Ù…ÙˆÙ† ÙØ§Ø±Ø³ÛŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .teacher-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Ù‡Ø¯Ø± */
        .teacher-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .teacher-info h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .teacher-info p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .primary-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .secondary-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .secondary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .success-btn {
            background: linear-gradient(45deg, #27ae60, #219a52);
            color: white;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .success-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .logout-btn {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 73, 94, 0.3);
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 73, 94, 0.4);
        }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø±ÛŒ */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 30px 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: #e74c3c;
        }

        .stat-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .stat-trend {
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 15px;
            display: inline-block;
            font-weight: bold;
        }

        .trend-up {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .trend-down {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        /* Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ */
        .dashboard-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .section:hover {
            border-color: #e74c3c;
        }

        .section-title {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.3rem;
        }

        /* Ù„ÛŒØ³Øª Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ */
        .exam-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .exam-item {
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .exam-item:hover {
            border-color: #e74c3c;
            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.2);
            transform: translateY(-2px);
        }

        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .exam-title {
            color: #2c3e50;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .exam-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active {
            background: #27ae60;
            color: white;
        }

        .status-inactive {
            background: #bdc3c7;
            color: white;
        }

        .status-upcoming {
            background: #3498db;
            color: white;
        }

        .exam-details {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .exam-details div {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .exam-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .edit-btn {
            background: #3498db;
            color: white;
        }

        .results-btn {
            background: #9b59b6;
            color: white;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .preview-btn {
            background: #f39c12;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† */
        .students-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .students-table th,
        .students-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid #ecf0f1;
        }

        .students-table th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
        }

        .students-table tr:hover {
            background: #f8f9fa;
        }

        .grade-excellent { color: #27ae60; font-weight: bold; }
        .grade-good { color: #f39c12; font-weight: bold; }
        .grade-average { color: #e67e22; font-weight: bold; }
        .grade-poor { color: #e74c3c; font-weight: bold; }

        /* Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹ */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .quick-action-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: bold;
        }

        .quick-action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .quick-action-btn.create-exam {
            background: linear-gradient(45deg, #27ae60, #219a52);
        }

        .quick-action-btn.create-exam:hover {
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        .quick-action-btn.view-results {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .quick-action-btn.view-results:hover {
            box-shadow: 0 8px 25px rgba(155, 89, 182, 0.3);
        }

        .quick-action-btn.manage-students {
            background: linear-gradient(45deg, #e67e22, #d35400);
        }

        .quick-action-btn.manage-students:hover {
            box-shadow: 0 8px 25px rgba(230, 126, 34, 0.3);
        }

        /* Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #ecf0f1;
        }

        .modal-title {
            color: #2c3e50;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            color: #7f8c8d;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: #e74c3c;
        }

        /* ÙØ±Ù…â€ŒÙ‡Ø§ */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .question-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #ecf0f1;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .remove-question {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .option-item input[type="text"] {
            flex: 1;
        }

        .option-item input[type="radio"] {
            width: auto;
        }

        .add-option {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }

        .add-question {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            margin-top: 20px;
            font-weight: bold;
        }

        /* Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ */
        .no-data {
            text-align: center;
            color: #7f8c8d;
            padding: 60px 20px;
            font-size: 1.1rem;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
            text-align: center;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
            text-align: center;
        }

        /* ÙÙˆØªØ± */
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .developer-credit {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 10px;
            font-size: 1rem;
        }

        /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            animation: fadeIn 0.6s ease-out;
        }

        /* Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø§Ø± */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #e74c3c;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #c0392b;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ */
        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-filter input,
        .search-filter select {
            padding: 10px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 14px;
        }

        .ai-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .ai-feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ai-feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .ai-feature-card h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .ai-feature-card p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .tab-btn.active {
            background: #e74c3c;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .level-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .level-beginner { background: #27ae60; color: white; }
        .level-intermediate { background: #f39c12; color: white; }
        .level-advanced { background: #e74c3c; color: white; }

        .notification-badge {
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="teacher-container">
        <!-- Ù‡Ø¯Ø± -->
        <div class="teacher-header">
            <div class="teacher-info">
                <h1>ğŸ‘¨â€ğŸ« Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ù„Ù…</h1>
                <p id="teacherWelcome">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</p>
            </div>
            <div class="header-actions">
                <button class="btn primary-btn" onclick="showCreateExamModal()">ğŸ“ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯</button>
                <button class="btn secondary-btn" onclick="viewAllResults()">ğŸ“Š Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†ØªØ§ÛŒØ¬</button>
                <button class="btn success-btn" onclick="showAIFeatures()">ğŸ¤– Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</button>
                <button class="btn logout-btn" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø±ÛŒ -->
        <div class="stats-cards">
            <div class="stat-card">
                <h3>ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</h3>
                <div class="stat-number" id="studentsCount">0</div>
                <div class="stat-trend trend-up">+Û²Ùª</div>
            </div>
            <div class="stat-card">
                <h3>Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h3>
                <div class="stat-number" id="activeExamsCount">0</div>
                <div class="stat-trend trend-up">+Û±</div>
            </div>
            <div class="stat-card">
                <h3>Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡</h3>
                <div class="stat-number" id="totalExamsCount">0</div>
                <div class="stat-trend trend-up">+Û±ÛµÙª</div>
            </div>
            <div class="stat-card">
                <h3>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„Ø§Ø³</h3>
                <div class="stat-number" id="classAverage">0%</div>
                <div class="stat-trend trend-up">+Û³Ùª</div>
            </div>
        </div>

        <!-- Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹ -->
        <div class="section">
            <h2 class="section-title">âš¡ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹</h2>
            <div class="quick-actions">
                <button class="quick-action-btn create-exam" onclick="showCreateExamModal()">
                    ğŸ“ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯
                </button>
                <button class="quick-action-btn view-results" onclick="viewAllResults()">
                    ğŸ“Š Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†ØªØ§ÛŒØ¬ Ú©Ø§Ù…Ù„
                </button>
                <button class="quick-action-btn manage-students" onclick="manageStudents()">
                    ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†
                </button>
                <button class="quick-action-btn" onclick="generateReport()">
                    ğŸ“ˆ ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´
                </button>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
        <div class="dashboard-sections">
            <!-- Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± -->
            <div class="section">
                <h2 class="section-title">
                    ğŸ“‹ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù…Ù†
                    <button class="btn primary-btn" style="padding: 10px 20px; font-size: 13px;" 
                            onclick="showCreateExamModal()">
                        + Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯
                    </button>
                </h2>
                
                <div class="search-filter">
                    <input type="text" id="examSearch" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§..." 
                           onkeyup="filterExams()">
                    <select id="examFilter" onchange="filterExams()">
                        <option value="all">Ù‡Ù…Ù‡ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§</option>
                        <option value="active">ÙØ¹Ø§Ù„</option>
                        <option value="upcoming">Ø¢ÛŒÙ†Ø¯Ù‡</option>
                        <option value="completed">Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ‡</option>
                    </select>
                </div>
                
                <div class="exam-list" id="recentExamsContainer">
                    <div class="no-data">ğŸ“­ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¢Ø²Ù…ÙˆÙ†ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯</div>
                </div>
            </div>

            <!-- Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø±ØªØ± -->
            <div class="section">
                <h2 class="section-title">ğŸ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø±ØªØ±</h2>
                
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="switchTab('topStudents', this)">Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§</button>
                        <button class="tab-btn" onclick="switchTab('allStudents', this)">Ù‡Ù…Ù‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</button>
                        <button class="tab-btn" onclick="switchTab('weakStudents', this)">
                            Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¬Ù‡ <span class="notification-badge" id="weakStudentsBadge">0</span>
                        </button>
                    </div>
                    
                    <div class="tab-content active" id="topStudents">
                        <table class="students-table">
                            <thead>
                                <tr>
                                    <th>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</th>
                                    <th>Ú©Ø¯ Ù…Ù„ÛŒ</th>
                                    <th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†</th>
                                    <th>Ø´Ø±Ú©Øª Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†</th>
                                </tr>
                            </thead>
                            <tbody id="topStudentsTableBody">
                                <tr>
                                    <td colspan="4" class="no-data">ğŸ“­ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="allStudents">
                        <table class="students-table">
                            <thead>
                                <tr>
                                    <th>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</th>
                                    <th>Ú©Ø¯ Ù…Ù„ÛŒ</th>
                                    <th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†</th>
                                    <th>Ø³Ø·Ø­</th>
                                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="allStudentsTableBody">
                                <tr>
                                    <td colspan="5" class="no-data">ğŸ“­ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="weakStudents">
                        <table class="students-table">
                            <thead>
                                <tr>
                                    <th>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</th>
                                    <th>Ú©Ø¯ Ù…Ù„ÛŒ</th>
                                    <th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†</th>
                                    <th>Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù</th>
                                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="weakStudentsTableBody">
                                <tr>
                                    <td colspan="5" class="no-data">ğŸ‰ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¬Ù‡ Ù†Ø¯Ø§Ø±Ø¯</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ -->
        <div class="section">
            <h2 class="section-title">ğŸ¤– ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h2>
            <div class="ai-features">
                <div class="ai-feature-card" onclick="generateQuestionsWithAI()">
                    <h3>ğŸ§  ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯</h3>
                    <p>Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆØ¶ÙˆØ¹ Ùˆ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ</p>
                </div>
                <div class="ai-feature-card" onclick="analyzeStudentPerformance()">
                    <h3>ğŸ“ˆ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</h3>
                    <p>Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ùˆ Ø¶Ø¹Ù Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</p>
                </div>
                <div class="ai-feature-card" onclick="generatePersonalizedExams()">
                    <h3>ğŸ¯ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡</h3>
                    <p>Ø·Ø±Ø§Ø­ÛŒ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</p>
                </div>
                <div class="ai-feature-card" onclick="predictStudentSuccess()">
                    <h3>ğŸ”® Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù…ÙˆÙÙ‚ÛŒØª</h3>
                    <p>Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡</p>
                </div>
            </div>
        </div>

        <!-- ÙÙˆØªØ± -->
        <div class="footer">
            <p>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ | Ù†Ø³Ø®Ù‡ Û².Û°</p>
            <p class="developer-credit">ğŸ› ï¸ ØªÙˆØ³Ø¹Ù‡ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø³ÛŒÙ†Ø§ Ø¬Ø¹ÙØ±ÛŒ</p>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† -->
    <div class="modal" id="createExamModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯</h3>
                <button class="close-modal" onclick="closeModal('createExamModal')">Ã—</button>
            </div>
            <form id="createExamForm">
                <div class="form-group">
                    <label for="examTitle">Ø¹Ù†ÙˆØ§Ù† Ø¢Ø²Ù…ÙˆÙ†:</label>
                    <input type="text" id="examTitle" required placeholder="Ù…Ø«Ø§Ù„: Ø¢Ø²Ù…ÙˆÙ† ÙØ§Ø±Ø³ÛŒ Ø¯Ø±Ø³ Ø§ÙˆÙ„">
                </div>
                
                <div class="form-group">
                    <label for="examSubject">Ø¯Ø±Ø³:</label>
                    <select id="examSubject" required>
                        <option value="ÙØ§Ø±Ø³ÛŒ">Ø²Ø¨Ø§Ù† Ùˆ Ø§Ø¯Ø¨ÛŒØ§Øª ÙØ§Ø±Ø³ÛŒ</option>
                        <option value="Ø±ÛŒØ§Ø¶ÛŒ">Ø±ÛŒØ§Ø¶ÛŒ</option>
                        <option value="Ø¹Ù„ÙˆÙ…">Ø¹Ù„ÙˆÙ… ØªØ¬Ø±Ø¨ÛŒ</option>
                        <option value="Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ">Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</option>
                        <option value="Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ">Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</option>
                        <option value="Ø¯ÛŒÙ†ÛŒ">Ù‡Ø¯ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¢Ø³Ù…Ø§Ù†ÛŒ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="examLevel">Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ:</label>
                    <select id="examLevel" required>
                        <option value="beginner">Ù…Ø¨ØªØ¯ÛŒ</option>
                        <option value="intermediate">Ù…ØªÙˆØ³Ø·</option>
                        <option value="advanced">Ù¾ÛŒØ´Ø±ÙØªÙ‡</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="examDuration">Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¢Ø²Ù…ÙˆÙ† (Ø¯Ù‚ÛŒÙ‚Ù‡):</label>
                    <input type="number" id="examDuration" required min="5" max="180" value="45">
                </div>

                <div class="form-group">
                    <label for="examEndTime">Ù…Ù‡Ù„Øª Ø§Ù†Ø¬Ø§Ù… Ø¢Ø²Ù…ÙˆÙ†:</label>
                    <input type="datetime-local" id="examEndTime" required>
                </div>

                <div class="form-group">
                    <label for="examDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¢Ø²Ù…ÙˆÙ† (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                    <textarea id="examDescription" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¢Ø²Ù…ÙˆÙ†..."></textarea>
                </div>

                <h4 style="margin: 30px 0 20px 0; color: #2c3e50; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px;">ğŸ“ Ø³ÙˆØ§Ù„Ø§Øª Ø¢Ø²Ù…ÙˆÙ†</h4>
                
                <div id="questionsContainer">
                    <!-- Ø³ÙˆØ§Ù„Ø§Øª Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="add-question" onclick="addQuestion()">+ Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯</button>
                    <button type="button" class="btn secondary-btn" onclick="generateQuestionsWithAI()">ğŸ¤– ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</button>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn success-btn" style="flex: 1;">âœ… Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ†</button>
                    <button type="button" class="btn secondary-btn" style="flex: 1;" onclick="closeModal('createExamModal')">âŒ Ø§Ù†ØµØ±Ø§Ù</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ -->
    <div class="modal" id="aiFeaturesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ¤– ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h3>
                <button class="close-modal" onclick="closeModal('aiFeaturesModal')">Ã—</button>
            </div>
            <div id="aiFeaturesContent">
                <div class="ai-features">
                    <div class="ai-feature-card" onclick="generateQuestionsWithAI()">
                        <h3>ğŸ§  ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯</h3>
                        <p>Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆØ¶ÙˆØ¹ Ùˆ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ</p>
                    </div>
                    <div class="ai-feature-card" onclick="analyzeStudentPerformance()">
                        <h3>ğŸ“ˆ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</h3>
                        <p>Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ùˆ Ø¶Ø¹Ù Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</p>
                    </div>
                    <div class="ai-feature-card" onclick="generatePersonalizedExams()">
                        <h3>ğŸ¯ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡</h3>
                        <p>Ø·Ø±Ø§Ø­ÛŒ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</p>
                    </div>
                    <div class="ai-feature-card" onclick="predictStudentSuccess()">
                        <h3>ğŸ”® Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù…ÙˆÙÙ‚ÛŒØª</h3>
                        <p>Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡</p>
                    </div>
                    <div class="ai-feature-card" onclick="aiGrading()">
                        <h3>ğŸ“ ØªØµØ­ÛŒØ­ Ø®ÙˆØ¯Ú©Ø§Ø±</h3>
                        <p>ØªØµØ­ÛŒØ­ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØªØ´Ø±ÛŒØ­ÛŒ Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</p>
                    </div>
                    <div class="ai-feature-card" onclick="learningPath()">
                        <h3>ğŸ—ºï¸ Ù…Ø³ÛŒØ± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</h3>
                        <p>Ø·Ø±Ø§Ø­ÛŒ Ù…Ø³ÛŒØ± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø´Ø®ØµÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ù†ØªØ§ÛŒØ¬ Ø¢Ø²Ù…ÙˆÙ† -->
    <div class="modal" id="examResultsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="resultsModalTitle">ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ø¢Ø²Ù…ÙˆÙ†</h3>
                <button class="close-modal" onclick="closeModal('examResultsModal')">Ã—</button>
            </div>
            <div id="examResultsContent">
                <!-- Ù†ØªØ§ÛŒØ¬ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
            </div>
        </div>
    </div>

    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ global
        let currentTeacher = null;
        let questionsCount = 0;

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', function() {
            loadTeacherData();
            loadStatistics();
            loadRecentExams();
            loadTopStudents();
            loadAllStudents();
            loadWeakStudents();
            initializeExamForm();
        });

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¹Ù„Ù…
        function loadTeacherData() {
            const savedTeacher = localStorage.getItem('currentTeacher');
            if (!savedTeacher) {
                window.location.href = 'teacher-login.html';
                return;
            }

            currentTeacher = JSON.parse(savedTeacher);
            document.getElementById('teacherWelcome').textContent = 
                `Ø³Ù„Ø§Ù… ${currentTeacher.fullName}! (${currentTeacher.subject})`;
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±
        function loadStatistics() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];

            // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¹Ù„Ù…
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);

            document.getElementById('studentsCount').textContent = students.length;
            document.getElementById('activeExamsCount').textContent = teacherExams.filter(exam => 
                new Date(exam.endTime) > new Date() && exam.isActive
            ).length;
            document.getElementById('totalExamsCount').textContent = teacherExams.length;

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„Ø§Ø³
            const teacherResults = results.filter(result => 
                teacherExams.some(exam => exam.id === result.examId)
            );
            
            if (teacherResults.length > 0) {
                const average = teacherResults.reduce((sum, result) => sum + result.percentage, 0) / teacherResults.length;
                document.getElementById('classAverage').textContent = average.toFixed(1) + '%';
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±
        function loadRecentExams() {
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            const container = document.getElementById('recentExamsContainer');

            if (teacherExams.length === 0) {
                container.innerHTML = '<div class="no-data">ğŸ“­ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¢Ø²Ù…ÙˆÙ†ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯</div>';
                return;
            }

            container.innerHTML = '';
            teacherExams.slice(0, 5).forEach(exam => {
                const isActive = new Date(exam.endTime) > new Date() && exam.isActive;
                const isUpcoming = new Date(exam.endTime) > new Date() && !exam.isActive;
                
                let statusClass = 'status-inactive';
                let statusText = 'Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ‡';
                
                if (isActive) {
                    statusClass = 'status-active';
                    statusText = 'ÙØ¹Ø§Ù„';
                } else if (isUpcoming) {
                    statusClass = 'status-upcoming';
                    statusText = 'Ø¢ÛŒÙ†Ø¯Ù‡';
                }

                const examItem = document.createElement('div');
                examItem.className = 'exam-item';
                
                examItem.innerHTML = `
                    <div class="exam-header">
                        <div class="exam-title">${exam.title}</div>
                        <div class="exam-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="exam-details">
                        <div>ğŸ“– Ø¯Ø±Ø³: ${exam.subject}</div>
                        <div>â° Ø²Ù…Ø§Ù†: ${exam.duration} Ø¯Ù‚ÛŒÙ‚Ù‡</div>
                        <div>ğŸ“‹ ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª: ${exam.questions.length}</div>
                        <div>ğŸ“… Ù…Ù‡Ù„Øª: ${new Date(exam.endTime).toLocaleDateString('fa-IR')}</div>
                        <div>ğŸ‘¥ Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†: ${getExamParticipantsCount(exam.id)} Ù†ÙØ±</div>
                        <div>ğŸ¯ Ø³Ø·Ø­: ${getExamLevelText(exam.level)}</div>
                    </div>
                    <div class="exam-actions">
                        <button class="action-btn preview-btn" onclick="previewExam('${exam.id}')">ğŸ‘ï¸ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´</button>
                        <button class="action-btn edit-btn" onclick="editExam('${exam.id}')">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                        <button class="action-btn results-btn" onclick="viewExamResults('${exam.id}')">ğŸ“Š Ù†ØªØ§ÛŒØ¬</button>
                        <button class="action-btn delete-btn" onclick="deleteExam('${exam.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                `;
                
                container.appendChild(examItem);
            });
        }

        // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§
        function filterExams() {
            const searchTerm = document.getElementById('examSearch').value.toLowerCase();
            const filterValue = document.getElementById('examFilter').value;
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            const container = document.getElementById('recentExamsContainer');

            let filteredExams = teacherExams.filter(exam => 
                exam.title.toLowerCase().includes(searchTerm) ||
                exam.subject.toLowerCase().includes(searchTerm)
            );

            if (filterValue !== 'all') {
                const now = new Date();
                filteredExams = filteredExams.filter(exam => {
                    const endTime = new Date(exam.endTime);
                    if (filterValue === 'active') {
                        return endTime > now && exam.isActive;
                    } else if (filterValue === 'upcoming') {
                        return endTime > now && !exam.isActive;
                    } else if (filterValue === 'completed') {
                        return endTime <= now;
                    }
                    return true;
                });
            }

            if (filteredExams.length === 0) {
                container.innerHTML = '<div class="no-data">ğŸ” Ù‡ÛŒÚ† Ø¢Ø²Ù…ÙˆÙ†ÛŒ Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø´Ù…Ø§ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                return;
            }

            container.innerHTML = '';
            filteredExams.forEach(exam => {
                const isActive = new Date(exam.endTime) > new Date() && exam.isActive;
                const isUpcoming = new Date(exam.endTime) > new Date() && !exam.isActive;
                
                let statusClass = 'status-inactive';
                let statusText = 'Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ‡';
                
                if (isActive) {
                    statusClass = 'status-active';
                    statusText = 'ÙØ¹Ø§Ù„';
                } else if (isUpcoming) {
                    statusClass = 'status-upcoming';
                    statusText = 'Ø¢ÛŒÙ†Ø¯Ù‡';
                }

                const examItem = document.createElement('div');
                examItem.className = 'exam-item';
                
                examItem.innerHTML = `
                    <div class="exam-header">
                        <div class="exam-title">${exam.title}</div>
                        <div class="exam-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="exam-details">
                        <div>ğŸ“– Ø¯Ø±Ø³: ${exam.subject}</div>
                        <div>â° Ø²Ù…Ø§Ù†: ${exam.duration} Ø¯Ù‚ÛŒÙ‚Ù‡</div>
                        <div>ğŸ“‹ ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª: ${exam.questions.length}</div>
                        <div>ğŸ“… Ù…Ù‡Ù„Øª: ${new Date(exam.endTime).toLocaleDateString('fa-IR')}</div>
                        <div>ğŸ‘¥ Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†: ${getExamParticipantsCount(exam.id)} Ù†ÙØ±</div>
                        <div>ğŸ¯ Ø³Ø·Ø­: ${getExamLevelText(exam.level)}</div>
                    </div>
                    <div class="exam-actions">
                        <button class="action-btn preview-btn" onclick="previewExam('${exam.id}')">ğŸ‘ï¸ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´</button>
                        <button class="action-btn edit-btn" onclick="editExam('${exam.id}')">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                        <button class="action-btn results-btn" onclick="viewExamResults('${exam.id}')">ğŸ“Š Ù†ØªØ§ÛŒØ¬</button>
                        <button class="action-btn delete-btn" onclick="deleteExam('${exam.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                `;
                
                container.appendChild(examItem);
            });
        }

        // ØªØ¹Ø¯Ø§Ø¯ Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù† Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†
        function getExamParticipantsCount(examId) {
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            return results.filter(result => result.examId === examId).length;
        }

        // Ù…ØªÙ† Ø³Ø·Ø­ Ø¢Ø²Ù…ÙˆÙ†
        function getExamLevelText(level) {
            switch(level) {
                case 'beginner': return 'Ù…Ø¨ØªØ¯ÛŒ';
                case 'intermediate': return 'Ù…ØªÙˆØ³Ø·';
                case 'advanced': return 'Ù¾ÛŒØ´Ø±ÙØªÙ‡';
                default: return 'Ù†Ø§Ù…Ø´Ø®Øµ';
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø±ØªØ±
        function loadTopStudents() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            
            const tbody = document.getElementById('topStudentsTableBody');

            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="no-data">ğŸ“­ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
            const studentAverages = students.map(student => {
                const studentResults = results.filter(result => 
                    result.studentId === student.nationalCode && 
                    teacherExams.some(exam => exam.id === result.examId)
                );
                
                const average = studentResults.length > 0 ? 
                    (studentResults.reduce((sum, result) => sum + result.percentage, 0) / studentResults.length).toFixed(1) : 
                    0;

                return {
                    ...student,
                    average: parseFloat(average),
                    examsTaken: studentResults.length
                };
            });

            // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†
            const topStudents = studentAverages
                .filter(student => student.examsTaken > 0)
                .sort((a, b) => b.average - a.average)
                .slice(0, 5);

            tbody.innerHTML = '';

            if (topStudents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="no-data">ğŸ¯ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ Ø´Ø±Ú©Øª Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }

            topStudents.forEach(student => {
                const gradeClass = getGradeClass(student.average);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${student.fullName}</strong></td>
                    <td>${student.nationalCode}</td>
                    <td class="${gradeClass}">${student.average}%</td>
                    <td>${student.examsTaken} Ø¢Ø²Ù…ÙˆÙ†</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†
        function loadAllStudents() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            
            const tbody = document.getElementById('allStudentsTableBody');

            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">ğŸ“­ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
            const studentAverages = students.map(student => {
                const studentResults = results.filter(result => 
                    result.studentId === student.nationalCode && 
                    teacherExams.some(exam => exam.id === result.examId)
                );
                
                const average = studentResults.length > 0 ? 
                    (studentResults.reduce((sum, result) => sum + result.percentage, 0) / studentResults.length).toFixed(1) : 
                    0;

                return {
                    ...student,
                    average: parseFloat(average),
                    examsTaken: studentResults.length,
                    level: getStudentLevel(parseFloat(average))
                };
            });

            tbody.innerHTML = '';

            studentAverages.forEach(student => {
                const gradeClass = getGradeClass(student.average);
                const levelClass = `level-${student.level}`;
                const levelText = getLevelText(student.level);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${student.fullName}</strong></td>
                    <td>${student.nationalCode}</td>
                    <td class="${gradeClass}">${student.average}%</td>
                    <td><span class="level-badge ${levelClass}">${levelText}</span></td>
                    <td>
                        <button class="action-btn edit-btn" onclick="viewStudentDetails('${student.nationalCode}')">Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>
                        <button class="action-btn secondary-btn" onclick="sendMessageToStudent('${student.nationalCode}')">Ù¾ÛŒØ§Ù…</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¶Ø¹ÛŒÙ
        function loadWeakStudents() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            
            const tbody = document.getElementById('weakStudentsTableBody');

            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">ğŸ“­ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
            const studentAverages = students.map(student => {
                const studentResults = results.filter(result => 
                    result.studentId === student.nationalCode && 
                    teacherExams.some(exam => exam.id === result.examId)
                );
                
                const average = studentResults.length > 0 ? 
                    (studentResults.reduce((sum, result) => sum + result.percentage, 0) / studentResults.length).toFixed(1) : 
                    0;

                return {
                    ...student,
                    average: parseFloat(average),
                    examsTaken: studentResults.length,
                    weakPoints: identifyWeakPoints(student.nationalCode, teacherExams, results)
                };
            });

            // ÙÛŒÙ„ØªØ± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¶Ø¹ÛŒÙ (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù…ØªØ± Ø§Ø² 50)
            const weakStudents = studentAverages.filter(student => 
                student.average < 50 && student.examsTaken > 0
            );

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ badge
            document.getElementById('weakStudentsBadge').textContent = weakStudents.length;

            tbody.innerHTML = '';

            if (weakStudents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">ğŸ‰ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¬Ù‡ Ù†Ø¯Ø§Ø±Ø¯</td></tr>';
                return;
            }

            weakStudents.forEach(student => {
                const gradeClass = getGradeClass(student.average);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${student.fullName}</strong></td>
                    <td>${student.nationalCode}</td>
                    <td class="${gradeClass}">${student.average}%</td>
                    <td>${student.weakPoints.join('ØŒ ')}</td>
                    <td>
                        <button class="action-btn success-btn" onclick="createPersonalizedPlan('${student.nationalCode}')">Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ</button>
                        <button class="action-btn secondary-btn" onclick="sendMessageToStudent('${student.nationalCode}')">Ù¾ÛŒØ§Ù…</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        function identifyWeakPoints(studentId, teacherExams, allResults) {
            const studentResults = allResults.filter(result => result.studentId === studentId);
            const weakPoints = [];
            
            // ØªØ­Ù„ÛŒÙ„ Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù
            teacherExams.forEach(exam => {
                const examResult = studentResults.find(result => result.examId === exam.id);
                if (examResult && examResult.percentage < 60) {
                    weakPoints.push(exam.subject);
                }
            });
            
            // Ø­Ø°Ù Ù…ÙˆØ§Ø±Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ
            return [...new Set(weakPoints)].slice(0, 3);
        }

        // ØªØ¹ÛŒÛŒÙ† Ø³Ø·Ø­ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        function getStudentLevel(average) {
            if (average >= 80) return 'advanced';
            if (average >= 60) return 'intermediate';
            return 'beginner';
        }

        // Ù…ØªÙ† Ø³Ø·Ø­ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        function getLevelText(level) {
            switch(level) {
                case 'beginner': return 'Ù…Ø¨ØªØ¯ÛŒ';
                case 'intermediate': return 'Ù…ØªÙˆØ³Ø·';
                case 'advanced': return 'Ù¾ÛŒØ´Ø±ÙØªÙ‡';
                default: return 'Ù†Ø§Ù…Ø´Ø®Øµ';
            }
        }

        // ØªØ¹ÛŒÛŒÙ† Ú©Ù„Ø§Ø³ Ù†Ù…Ø±Ù‡
        function getGradeClass(percentage) {
            if (percentage >= 90) return 'grade-excellent';
            if (percentage >= 75) return 'grade-good';
            if (percentage >= 50) return 'grade-average';
            return 'grade-poor';
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ†
        function showCreateExamModal() {
            questionsCount = 0;
            document.getElementById('questionsContainer').innerHTML = '';
            document.getElementById('examTitle').value = '';
            document.getElementById('examSubject').value = 'ÙØ§Ø±Ø³ÛŒ';
            document.getElementById('examLevel').value = 'intermediate';
            document.getElementById('examDuration').value = '45';
            document.getElementById('examDescription').value = '';
            
            // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ù„Øª Ø¢Ø²Ù…ÙˆÙ† (Û² Ø±ÙˆØ² Ø¨Ø¹Ø¯)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 2);
            document.getElementById('examEndTime').value = tomorrow.toISOString().slice(0, 16);
            
            addQuestion(); // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† Ø³ÙˆØ§Ù„
            showModal('createExamModal');
        }

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ÙØ±Ù… Ø¢Ø²Ù…ÙˆÙ†
        function initializeExamForm() {
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ†
            document.getElementById('createExamForm').addEventListener('submit', function(e) {
                e.preventDefault();
                createNewExam();
            });
        }

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯
        function addQuestion() {
            questionsCount++;
            const questionId = `question_${questionsCount}`;
            
            const questionHTML = `
                <div class="question-item" id="${questionId}">
                    <div class="question-header">
                        <strong>Ø³ÙˆØ§Ù„ ${questionsCount}</strong>
                        <button type="button" class="remove-question" onclick="removeQuestion('${questionId}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                    <div class="form-group">
                        <label>Ù…ØªÙ† Ø³ÙˆØ§Ù„:</label>
                        <textarea placeholder="Ù…ØªÙ† Ø³ÙˆØ§Ù„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§:</label>
                        <div class="option-item">
                            <input type="radio" name="correct_${questionsCount}" value="0" checked>
                            <input type="text" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û±" required>
                        </div>
                        <div class="option-item">
                            <input type="radio" name="correct_${questionsCount}" value="1">
                            <input type="text" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û²" required>
                        </div>
                        <div class="option-item">
                            <input type="radio" name="correct_${questionsCount}" value="2">
                            <input type="text" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û³" required>
                        </div>
                        <div class="option-item">
                            <input type="radio" name="correct_${questionsCount}" value="3">
                            <input type="text" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û´" required>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('questionsContainer').insertAdjacentHTML('beforeend', questionHTML);
        }

        // Ø­Ø°Ù Ø³ÙˆØ§Ù„
        function removeQuestion(questionId) {
            if (questionsCount > 1) {
                document.getElementById(questionId).remove();
                questionsCount--;
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„Ø§Øª
                updateQuestionNumbers();
            } else {
                alert('âŒ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³ÙˆØ§Ù„ Ø¨Ø§ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯');
            }
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„Ø§Øª
        function updateQuestionNumbers() {
            const questions = document.querySelectorAll('.question-item');
            questions.forEach((question, index) => {
                const header = question.querySelector('.question-header strong');
                header.textContent = `Ø³ÙˆØ§Ù„ ${index + 1}`;
            });
        }

        // Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯
        function createNewExam() {
            const title = document.getElementById('examTitle').value;
            const subject = document.getElementById('examSubject').value;
            const level = document.getElementById('examLevel').value;
            const duration = parseInt(document.getElementById('examDuration').value);
            const endTime = document.getElementById('examEndTime').value;
            const description = document.getElementById('examDescription').value;

            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…
            if (!validateExamForm()) {
                return;
            }

            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø³ÙˆØ§Ù„Ø§Øª
            const questions = [];
            const questionItems = document.querySelectorAll('.question-item');
            
            let hasError = false;
            
            questionItems.forEach((questionItem, index) => {
                const questionText = questionItem.querySelector('textarea').value;
                const options = questionItem.querySelectorAll('.option-item input[type="text"]');
                const correctAnswer = parseInt(questionItem.querySelector('input[type="radio"]:checked').value);
                
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
                if (!questionText.trim()) {
                    alert(`âŒ Ù…ØªÙ† Ø³ÙˆØ§Ù„ ${index + 1} Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯`);
                    hasError = true;
                    return;
                }
                
                const optionTexts = [];
                options.forEach(option => {
                    if (!option.value.trim()) {
                        alert(`âŒ ØªÙ…Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„ ${index + 1} Ø¨Ø§ÛŒØ¯ Ù¾Ø± Ø´ÙˆÙ†Ø¯`);
                        hasError = true;
                        return;
                    }
                    optionTexts.push(option.value);
                });
                
                if (hasError) return;
                
                questions.push({
                    id: index + 1,
                    text: questionText,
                    options: optionTexts,
                    correctAnswer: correctAnswer
                });
            });
            
            if (hasError) return;
            
            if (questions.length === 0) {
                alert('âŒ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³ÙˆØ§Ù„ Ø¨Ø§ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯');
                return;
            }

            // Ø§ÛŒØ¬Ø§Ø¯ Ø´ÛŒØ¡ Ø¢Ø²Ù…ÙˆÙ†
            const newExam = {
                id: 'exam_' + Date.now(),
                title: title,
                subject: subject,
                level: level,
                duration: duration,
                questions: questions,
                description: description,
                createdBy: currentTeacher.nationalCode,
                createdAt: new Date().toISOString(),
                endTime: endTime,
                isActive: true
            };

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            exams.push(newExam);
            localStorage.setItem('exams', JSON.stringify(exams));

            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
            showSuccessMessage('âœ… Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!');

            // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª
            closeModal('createExamModal');
            loadRecentExams();
            loadStatistics();
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ø¢Ø²Ù…ÙˆÙ†
        function validateExamForm() {
            const title = document.getElementById('examTitle').value.trim();
            const duration = parseInt(document.getElementById('examDuration').value);
            const endTime = new Date(document.getElementById('examEndTime').value);
            
            if (title.length < 3) {
                showError('Ø¹Ù†ÙˆØ§Ù† Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                return false;
            }
            
            if (duration < 5 || duration > 180) {
                showError('Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Ûµ ØªØ§ Û±Û¸Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø§Ø´Ø¯');
                return false;
            }
            
            if (endTime <= new Date()) {
                showError('Ù…Ù‡Ù„Øª Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø§Ø´Ø¯');
                return false;
            }
            
            return true;
        }

        // Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¢Ø²Ù…ÙˆÙ†
        function previewExam(examId) {
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const exam = exams.find(e => e.id === examId);
            
            if (exam) {
                let previewHTML = `<h3>${exam.title}</h3>`;
                previewHTML += `<p><strong>Ø¯Ø±Ø³:</strong> ${exam.subject}</p>`;
                previewHTML += `<p><strong>Ø³Ø·Ø­:</strong> ${getExamLevelText(exam.level)}</p>`;
                previewHTML += `<p><strong>Ù…Ø¯Øª Ø²Ù…Ø§Ù†:</strong> ${exam.duration} Ø¯Ù‚ÛŒÙ‚Ù‡</p>`;
                previewHTML += `<p><strong>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª:</strong> ${exam.questions.length}</p>`;
                if (exam.description) {
                    previewHTML += `<p><strong>ØªÙˆØ¶ÛŒØ­Ø§Øª:</strong> ${exam.description}</p>`;
                }
                previewHTML += `<hr style="margin: 20px 0;">`;
                
                exam.questions.forEach((question, index) => {
                    previewHTML += `
                        <div style="margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                            <strong>Ø³ÙˆØ§Ù„ ${index + 1}:</strong> ${question.text}
                            <div style="margin-top: 10px; margin-right: 20px;">
                                ${question.options.map((option, optIndex) => `
                                    <div>${String.fromCharCode(1570 + optIndex)}) ${option} ${optIndex === question.correctAnswer ? 'âœ…' : ''}</div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });
                
                alert(previewHTML);
            }
        }

        // ÙˆÛŒØ±Ø§ÛŒØ´ Ø¢Ø²Ù…ÙˆÙ†
        function editExam(examId) {
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const exam = exams.find(e => e.id === examId);
            
            if (exam) {
                // Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡ØŒ ÙÙ‚Ø· Ø§Ù…Ú©Ø§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ Ø¹Ù†ÙˆØ§Ù† Ùˆ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                const newTitle = prompt('Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÛŒØ¯ Ø¢Ø²Ù…ÙˆÙ†:', exam.title);
                if (newTitle && newTitle.trim() !== '') {
                    exam.title = newTitle.trim();
                    localStorage.setItem('exams', JSON.stringify(exams));
                    showSuccessMessage('âœ… Ø¹Ù†ÙˆØ§Ù† Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯');
                    loadRecentExams();
                }
                
                // Ø§Ù…Ú©Ø§Ù† ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù†
                const newStatus = confirm(`Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÙˆØ¶Ø¹ÛŒØª Ø¢Ø²Ù…ÙˆÙ† "${exam.title}" Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ØŸ\n\nØ§Ú©Ù†ÙˆÙ†: ${exam.isActive ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}`);
                if (newStatus !== null) {
                    exam.isActive = !exam.isActive;
                    localStorage.setItem('exams', JSON.stringify(exams));
                    showSuccessMessage(`âœ… ÙˆØ¶Ø¹ÛŒØª Ø¢Ø²Ù…ÙˆÙ† Ø¨Ù‡ ${exam.isActive ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª`);
                    loadRecentExams();
                }
            }
        }

        // Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†ØªØ§ÛŒØ¬ Ø¢Ø²Ù…ÙˆÙ†
        function viewExamResults(examId) {
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const exam = exams.find(e => e.id === examId);
            
            if (exam) {
                const examResults = results.filter(result => result.examId === examId);
                
                if (examResults.length === 0) {
                    alert('ğŸ“Š Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ†â€ŒÚ©Ø³ Ø¯Ø± Ø§ÛŒÙ† Ø¢Ø²Ù…ÙˆÙ† Ø´Ø±Ú©Øª Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª');
                    return;
                }
                
                let resultsHTML = `<h3>Ù†ØªØ§ÛŒØ¬ ${exam.title}</h3>`;
                resultsHTML += `<p>ØªØ¹Ø¯Ø§Ø¯ Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†: ${examResults.length} Ù†ÙØ±</p>`;
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
                const avgScore = examResults.reduce((sum, result) => sum + result.percentage, 0) / examResults.length;
                const maxScore = Math.max(...examResults.map(result => result.percentage));
                const minScore = Math.min(...examResults.map(result => result.percentage));
                
                resultsHTML += `
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #27ae60;">${avgScore.toFixed(1)}%</div>
                            <div style="font-size: 0.8rem;">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„Ø§Ø³</div>
                        </div>
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #2196f3;">${maxScore}%</div>
                            <div style="font-size: 0.8rem;">Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù†Ù…Ø±Ù‡</div>
                        </div>
                        <div style="background: #ffebee; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold; color: #f44336;">${minScore}%</div>
                            <div style="font-size: 0.8rem;">Ú©Ù…ØªØ±ÛŒÙ† Ù†Ù…Ø±Ù‡</div>
                        </div>
                    </div>
                `;
                
                resultsHTML += `<hr style="margin: 15px 0;">`;
                
                // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù…Ø±Ù‡
                examResults.sort((a, b) => b.percentage - a.percentage);
                
                resultsHTML += `<div style="max-height: 400px; overflow-y: auto;">`;
                
                examResults.forEach((result, index) => {
                    const student = students.find(s => s.nationalCode === result.studentId);
                    const studentName = student ? student.fullName : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                    const gradeClass = getGradeClass(result.percentage);
                    
                    resultsHTML += `
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Ø±ØªØ¨Ù‡ ${index + 1}:</strong> ${studentName}<br>
                                <span class="${gradeClass}">Ù†Ù…Ø±Ù‡: ${result.score}/${result.totalScore} (${result.percentage}%)</span><br>
                                <small>ØªØ§Ø±ÛŒØ®: ${new Date(result.submitDate).toLocaleDateString('fa-IR')}</small>
                            </div>
                            <div>
                                <button class="action-btn secondary-btn" onclick="viewStudentExamDetails('${result.studentId}', '${examId}')">Ø¬Ø²Ø¦ÛŒØ§Øª</button>
                            </div>
                        </div>
                    `;
                });
                
                resultsHTML += `</div>`;
                
                // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„
                document.getElementById('resultsModalTitle').textContent = `ğŸ“Š Ù†ØªØ§ÛŒØ¬ ${exam.title}`;
                document.getElementById('examResultsContent').innerHTML = resultsHTML;
                showModal('examResultsModal');
            }
        }

        // Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¢Ø²Ù…ÙˆÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        function viewStudentExamDetails(studentId, examId) {
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            
            const result = results.find(r => r.studentId === studentId && r.examId === examId);
            const student = students.find(s => s.nationalCode === studentId);
            const exam = exams.find(e => e.id === examId);
            
            if (result && student && exam) {
                let detailsHTML = `
                    <h3>Ø¬Ø²Ø¦ÛŒØ§Øª Ø¢Ø²Ù…ÙˆÙ† ${student.fullName}</h3>
                    <p><strong>Ø¢Ø²Ù…ÙˆÙ†:</strong> ${exam.title}</p>
                    <p><strong>Ù†Ù…Ø±Ù‡:</strong> ${result.score}/${result.totalScore} (${result.percentage}%)</p>
                    <p><strong>Ø²Ù…Ø§Ù† ØµØ±Ù Ø´Ø¯Ù‡:</strong> ${result.timeSpent} Ø¯Ù‚ÛŒÙ‚Ù‡</p>
                    <hr style="margin: 15px 0;">
                    <h4>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²:</h4>
                `;
                
                result.answers.forEach((answer, index) => {
                    const question = exam.questions[index];
                    const isCorrect = answer === question.correctAnswer;
                    const correctAnswerText = question.options[question.correctAnswer];
                    const studentAnswerText = question.options[answer];
                    
                    detailsHTML += `
                        <div style="margin-bottom: 15px; padding: 15px; background: ${isCorrect ? '#e8f5e8' : '#ffebee'}; border-radius: 8px;">
                            <strong>Ø³ÙˆØ§Ù„ ${index + 1}:</strong> ${question.text}<br>
                            <div style="margin-top: 10px;">
                                <span style="color: ${isCorrect ? '#27ae60' : '#e74c3c'};">
                                    ${isCorrect ? 'âœ… Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­' : 'âŒ Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª'}
                                </span><br>
                                <strong>Ù¾Ø§Ø³Ø® Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²:</strong> ${studentAnswerText || 'Ù¾Ø§Ø³Ø® Ù†Ø¯Ø§Ø¯Ù‡'}<br>
                                ${!isCorrect ? `<strong>Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­:</strong> ${correctAnswerText}<br>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                alert(detailsHTML);
            }
        }

        // Ø­Ø°Ù Ø¢Ø²Ù…ÙˆÙ†
        function deleteExam(examId) {
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const exam = exams.find(e => e.id === examId);
            
            if (exam && confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¢Ø²Ù…ÙˆÙ† "${exam.title}" Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ\nØ§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!`)) {
                const updatedExams = exams.filter(e => e.id !== examId);
                localStorage.setItem('exams', JSON.stringify(updatedExams));
                showSuccessMessage('âœ… Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯');
                loadRecentExams();
                loadStatistics();
            }
        }

        // Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù… Ù†ØªØ§ÛŒØ¬
        function viewAllResults() {
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            
            if (teacherExams.length === 0) {
                alert('ğŸ“Š Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¢Ø²Ù…ÙˆÙ†ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯');
                return;
            }
            
            const teacherResults = results.filter(result => 
                teacherExams.some(exam => exam.id === result.examId)
            );
            
            if (teacherResults.length === 0) {
                alert('ğŸ“Š Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø´Ø±Ú©Øª Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª');
                return;
            }
            
            let allResultsHTML = `<h3>ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ú©Ù„ÛŒ ØªÙ…Ø§Ù… Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§</h3>`;
            
            // Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
            const totalStudents = [...new Set(teacherResults.map(result => result.studentId))].length;
            const totalExams = teacherExams.length;
            const avgOverall = teacherResults.reduce((sum, result) => sum + result.percentage, 0) / teacherResults.length;
            
            allResultsHTML += `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: #27ae60;">${totalStudents}</div>
                        <div style="font-size: 0.8rem;">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</div>
                    </div>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: #2196f3;">${totalExams}</div>
                        <div style="font-size: 0.8rem;">ØªØ¹Ø¯Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§</div>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: #ff9800;">${avgOverall.toFixed(1)}%</div>
                        <div style="font-size: 0.8rem;">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„ÛŒ</div>
                    </div>
                </div>
            `;
            
            allResultsHTML += `<hr style="margin: 15px 0;">`;
            allResultsHTML += `<h4>Ù†ØªØ§ÛŒØ¬ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ø¢Ø²Ù…ÙˆÙ†:</h4>`;
            
            teacherExams.forEach(exam => {
                const examResults = teacherResults.filter(result => result.examId === exam.id);
                if (examResults.length > 0) {
                    const examAvg = examResults.reduce((sum, result) => sum + result.percentage, 0) / examResults.length;
                    allResultsHTML += `
                        <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <strong>${exam.title}</strong> (${exam.subject})<br>
                            <span>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: ${examAvg.toFixed(1)}% | Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†: ${examResults.length} Ù†ÙØ±</span><br>
                            <button class="action-btn secondary-btn" onclick="viewExamResults('${exam.id}')" style="margin-top: 10px;">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>
                        </div>
                    `;
                }
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„
            document.getElementById('resultsModalTitle').textContent = 'ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ú©Ù„ÛŒ ØªÙ…Ø§Ù… Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§';
            document.getElementById('examResultsContent').innerHTML = allResultsHTML;
            showModal('examResultsModal');
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†
        function manageStudents() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            alert(`ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†\n\nØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: ${students.length} Ù†ÙØ±\n\nØ¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø¨Ù‡ ØªØ¨ "Ù‡Ù…Ù‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†" Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯.`);
        }

        // ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´
        function generateReport() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            const teacherResults = results.filter(result => 
                teacherExams.some(exam => exam.id === result.examId)
            );
            
            let reportHTML = `
                <h3>ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©Ù„Ø§Ø³</h3>
                <p><strong>ØªØ§Ø±ÛŒØ® ØªÙˆÙ„ÛŒØ¯:</strong> ${new Date().toLocaleDateString('fa-IR')}</p>
                <hr style="margin: 15px 0;">
            `;
            
            // Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
            reportHTML += `
                <h4>Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</h4>
                <ul>
                    <li>ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: ${students.length} Ù†ÙØ±</li>
                    <li>ØªØ¹Ø¯Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡: ${teacherExams.length}</li>
                    <li>ØªØ¹Ø¯Ø§Ø¯ Ø´Ø±Ú©Øª Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§: ${teacherResults.length} Ø¨Ø§Ø±</li>
                    <li>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù†Ù…Ø±Ù‡ Ú©Ù„Ø§Ø³: ${teacherResults.length > 0 ? (teacherResults.reduce((sum, result) => sum + result.percentage, 0) / teacherResults.length).toFixed(1) : 0}%</li>
                </ul>
            `;
            
            // Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø±ØªØ±
            const studentAverages = students.map(student => {
                const studentResults = teacherResults.filter(result => result.studentId === student.nationalCode);
                const average = studentResults.length > 0 ? 
                    (studentResults.reduce((sum, result) => sum + result.percentage, 0) / studentResults.length).toFixed(1) : 
                    0;
                return {
                    ...student,
                    average: parseFloat(average),
                    examsTaken: studentResults.length
                };
            });
            
            const topStudents = studentAverages
                .filter(student => student.examsTaken > 0)
                .sort((a, b) => b.average - a.average)
                .slice(0, 3);
            
            if (topStudents.length > 0) {
                reportHTML += `
                    <h4>Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø±ØªØ±</h4>
                    <ol>
                        ${topStudents.map(student => `
                            <li>${student.fullName} - ${student.average}% (${student.examsTaken} Ø¢Ø²Ù…ÙˆÙ†)</li>
                        `).join('')}
                    </ol>
                `;
            }
            
            // Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±
            const recentExams = teacherExams
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);
            
            if (recentExams.length > 0) {
                reportHTML += `
                    <h4>Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h4>
                    <ul>
                        ${recentExams.map(exam => `
                            <li>${exam.title} (${exam.subject}) - ${new Date(exam.createdAt).toLocaleDateString('fa-IR')}</li>
                        `).join('')}
                    </ul>
                `;
            }
            
            // Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´
            document.getElementById('resultsModalTitle').textContent = 'ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©Ù„Ø§Ø³';
            document.getElementById('examResultsContent').innerHTML = reportHTML;
            showModal('examResultsModal');
        }

        // Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        function viewStudentDetails(studentId) {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            
            const student = students.find(s => s.nationalCode === studentId);
            const studentResults = results.filter(result => 
                result.studentId === studentId && 
                teacherExams.some(exam => exam.id === result.examId)
            );
            
            if (student) {
                let detailsHTML = `
                    <h3>ğŸ‘¤ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</h3>
                    <p><strong>Ù†Ø§Ù… Ú©Ø§Ù…Ù„:</strong> ${student.fullName}</p>
                    <p><strong>Ú©Ø¯ Ù…Ù„ÛŒ:</strong> ${student.nationalCode}</p>
                    <p><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> ${student.phone || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                    <p><strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> ${student.email || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                    <hr style="margin: 15px 0;">
                `;
                
                if (studentResults.length > 0) {
                    const average = studentResults.reduce((sum, result) => sum + result.percentage, 0) / studentResults.length;
                    const bestScore = Math.max(...studentResults.map(result => result.percentage));
                    const worstScore = Math.min(...studentResults.map(result => result.percentage));
                    
                    detailsHTML += `
                        <h4>ğŸ“Š Ø¹Ù…Ù„Ú©Ø±Ø¯ ØªØ­ØµÛŒÙ„ÛŒ</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0;">
                            <div style="background: #e8f5e8; padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="font-weight: bold; color: #27ae60;">${average.toFixed(1)}%</div>
                                <div style="font-size: 0.8rem;">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="font-weight: bold; color: #2196f3;">${bestScore}%</div>
                                <div style="font-size: 0.8rem;">Ø¨Ù‡ØªØ±ÛŒÙ† Ù†Ù…Ø±Ù‡</div>
                            </div>
                            <div style="background: #ffebee; padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="font-weight: bold; color: #f44336;">${worstScore}%</div>
                                <div style="font-size: 0.8rem;">Ú©Ù…ØªØ±ÛŒÙ† Ù†Ù…Ø±Ù‡</div>
                            </div>
                        </div>
                        
                        <h4>ğŸ“‹ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§</h4>
                    `;
                    
                    studentResults.forEach(result => {
                        const exam = teacherExams.find(e => e.id === result.examId);
                        if (exam) {
                            const gradeClass = getGradeClass(result.percentage);
                            detailsHTML += `
                                <div style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                    <strong>${exam.title}</strong><br>
                                    <span class="${gradeClass}">Ù†Ù…Ø±Ù‡: ${result.score}/${result.totalScore} (${result.percentage}%)</span><br>
                                    <small>ØªØ§Ø±ÛŒØ®: ${new Date(result.submitDate).toLocaleDateString('fa-IR')}</small>
                                </div>
                            `;
                        }
                    });
                } else {
                    detailsHTML += `<p>ğŸ¯ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù‡Ù†ÙˆØ² Ø¯Ø± Ù‡ÛŒÚ† Ø¢Ø²Ù…ÙˆÙ†ÛŒ Ø´Ø±Ú©Øª Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª.</p>`;
                }
                
                // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„
                document.getElementById('resultsModalTitle').textContent = `ğŸ‘¤ Ø¬Ø²Ø¦ÛŒØ§Øª ${student.fullName}`;
                document.getElementById('examResultsContent').innerHTML = detailsHTML;
                showModal('examResultsModal');
            }
        }

        // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        function sendMessageToStudent(studentId) {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const student = students.find(s => s.nationalCode === studentId);
            
            if (student) {
                const message = prompt(`Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ ${student.fullName}:`, '');
                if (message && message.trim() !== '') {
                    // Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡ØŒ Ù¾ÛŒØ§Ù… Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù„Ø§Ú¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                    console.log(`Ù¾ÛŒØ§Ù… Ø¨Ù‡ ${student.fullName}: ${message}`);
                    showSuccessMessage(`âœ… Ù¾ÛŒØ§Ù… Ø¨Ù‡ ${student.fullName} Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯`);
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù… Ø¯Ø± localStorage
                    const messages = JSON.parse(localStorage.getItem('teacherMessages')) || [];
                    messages.push({
                        id: 'msg_' + Date.now(),
                        teacherId: currentTeacher.nationalCode,
                        studentId: studentId,
                        message: message.trim(),
                        date: new Date().toISOString(),
                        read: false
                    });
                    localStorage.setItem('teacherMessages', JSON.stringify(messages));
                }
            }
        }

        // Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
        function createPersonalizedPlan(studentId) {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const student = students.find(s => s.nationalCode === studentId);
            
            if (student) {
                const plan = prompt(`Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¨Ø±Ø§ÛŒ ${student.fullName}:\n\nÙ…ÙˆØ¶ÙˆØ¹Ø§Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:`, 'Ø±ÛŒØ§Ø¶ÛŒ - Ø¬Ø¨Ø± Ùˆ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª');
                if (plan && plan.trim() !== '') {
                    // Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø± localStorage
                    const plans = JSON.parse(localStorage.getItem('studentPlans')) || [];
                    plans.push({
                        id: 'plan_' + Date.now(),
                        studentId: studentId,
                        teacherId: currentTeacher.nationalCode,
                        plan: plan.trim(),
                        createdDate: new Date().toISOString(),
                        completed: false
                    });
                    localStorage.setItem('studentPlans', JSON.stringify(plans));
                    
                    showSuccessMessage(`âœ… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¨Ø±Ø§ÛŒ ${student.fullName} Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`);
                }
            }
        }

        // ØªØºÛŒÛŒØ± ØªØ¨
        function switchTab(tabName, element) {
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù…Ø­ØªÙˆØ§Ù‡Ø§
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            element.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²
            if (tabName === 'allStudents') {
                loadAllStudents();
            } else if (tabName === 'weakStudents') {
                loadWeakStudents();
            } else if (tabName === 'topStudents') {
                loadTopStudents();
            }
        }

        // Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        function showAIFeatures() {
            showModal('aiFeaturesModal');
        }

        // ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        function generateQuestionsWithAI() {
            const subject = document.getElementById('examSubject').value || 'ÙØ§Ø±Ø³ÛŒ';
            const level = document.getElementById('examLevel').value || 'intermediate';
            const count = 5; // ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ - Ø¯Ø± Ù†Ø³Ø®Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø§ API ÙˆØ§Ù‚Ø¹ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆØ¯
            const aiQuestions = generateAISampleQuestions(subject, level, count);
            
            let questionsHTML = '<h3>ğŸ§  Ø³ÙˆØ§Ù„Ø§Øª ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h3>';
            questionsHTML += `<p>Ù…ÙˆØ¶ÙˆØ¹: ${subject} | Ø³Ø·Ø­: ${getExamLevelText(level)}</p>`;
            questionsHTML += '<hr style="margin: 15px 0;">';
            
            aiQuestions.forEach((question, index) => {
                questionsHTML += `
                    <div style="margin-bottom: 20px; padding: 15px; background: #f0f8ff; border-radius: 10px;">
                        <strong>Ø³ÙˆØ§Ù„ ${index + 1}:</strong> ${question.text}
                        <div style="margin-top: 10px; margin-right: 20px;">
                            ${question.options.map((option, optIndex) => `
                                <div>${String.fromCharCode(1570 + optIndex)}) ${option} ${optIndex === question.correctAnswer ? 'âœ…' : ''}</div>
                            `).join('')}
                        </div>
                        <button class="action-btn success-btn" onclick="addAIQuestion(${index})" style="margin-top: 10px;">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø¢Ø²Ù…ÙˆÙ†</button>
                    </div>
                `;
            });
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø³ÙˆØ§Ù„Ø§Øª AI Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
            localStorage.setItem('aiGeneratedQuestions', JSON.stringify(aiQuestions));
            
            document.getElementById('resultsModalTitle').textContent = 'ğŸ§  Ø³ÙˆØ§Ù„Ø§Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ';
            document.getElementById('examResultsContent').innerHTML = questionsHTML;
            showModal('examResultsModal');
        }

        // Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„ AI Ø¨Ù‡ Ø¢Ø²Ù…ÙˆÙ†
        function addAIQuestion(questionIndex) {
            const aiQuestions = JSON.parse(localStorage.getItem('aiGeneratedQuestions')) || [];
            const question = aiQuestions[questionIndex];
            
            if (question) {
                questionsCount++;
                const questionId = `question_${questionsCount}`;
                
                const questionHTML = `
                    <div class="question-item" id="${questionId}">
                        <div class="question-header">
                            <strong>Ø³ÙˆØ§Ù„ ${questionsCount} (Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ)</strong>
                            <button type="button" class="remove-question" onclick="removeQuestion('${questionId}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                        <div class="form-group">
                            <label>Ù…ØªÙ† Ø³ÙˆØ§Ù„:</label>
                            <textarea placeholder="Ù…ØªÙ† Ø³ÙˆØ§Ù„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." required>${question.text}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§:</label>
                            ${question.options.map((option, optIndex) => `
                                <div class="option-item">
                                    <input type="radio" name="correct_${questionsCount}" value="${optIndex}" ${optIndex === question.correctAnswer ? 'checked' : ''}>
                                    <input type="text" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ ${optIndex + 1}" value="${option}" required>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                document.getElementById('questionsContainer').insertAdjacentHTML('beforeend', questionHTML);
                closeModal('examResultsModal');
                showSuccessMessage('âœ… Ø³ÙˆØ§Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ù‡ Ø¢Ø²Ù…ÙˆÙ† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            }
        }

        // ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        function analyzeStudentPerformance() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            
            if (students.length === 0) {
                alert('ğŸ‘¥ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                return;
            }
            
            let analysisHTML = '<h3>ğŸ“ˆ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h3>';
            analysisHTML += '<hr style="margin: 15px 0;">';
            
            // ØªØ­Ù„ÛŒÙ„ Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
            students.forEach(student => {
                const studentResults = results.filter(result => 
                    result.studentId === student.nationalCode && 
                    teacherExams.some(exam => exam.id === result.examId)
                );
                
                if (studentResults.length > 0) {
                    const average = studentResults.reduce((sum, result) => sum + result.percentage, 0) / studentResults.length;
                    const trend = calculatePerformanceTrend(studentResults);
                    const weakSubjects = identifyWeakSubjects(student.nationalCode, teacherExams, results);
                    
                    analysisHTML += `
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                            <h4>${student.fullName}</h4>
                            <p><strong>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù†Ù…Ø±Ø§Øª:</strong> ${average.toFixed(1)}%</p>
                            <p><strong>Ø±ÙˆÙ†Ø¯ Ø¹Ù…Ù„Ú©Ø±Ø¯:</strong> ${trend}</p>
                            ${weakSubjects.length > 0 ? `<p><strong>Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ø¯Ø±:</strong> ${weakSubjects.join('ØŒ ')}</p>` : '<p>ğŸ‰ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø·Ù„ÙˆØ¨ Ø¯Ø± ØªÙ…Ø§Ù… Ø¯Ø±ÙˆØ³</p>'}
                            <button class="action-btn secondary-btn" onclick="viewStudentDetails('${student.nationalCode}')">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>
                        </div>
                    `;
                } else {
                    analysisHTML += `
                        <div style="margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 10px;">
                            <h4>${student.fullName}</h4>
                            <p>ğŸ“­ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù‡Ù†ÙˆØ² Ø¯Ø± Ù‡ÛŒÚ† Ø¢Ø²Ù…ÙˆÙ†ÛŒ Ø´Ø±Ú©Øª Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª</p>
                        </div>
                    `;
                }
            });
            
            // Ù†Ù…Ø§ÛŒØ´ ØªØ­Ù„ÛŒÙ„
            document.getElementById('resultsModalTitle').textContent = 'ğŸ“ˆ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†';
            document.getElementById('examResultsContent').innerHTML = analysisHTML;
            showModal('examResultsModal');
        }

        // ØªÙˆÙ„ÛŒØ¯ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
        function generatePersonalizedExams() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            
            if (students.length === 0) {
                alert('ğŸ‘¥ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                return;
            }
            
            let personalizedHTML = '<h3>ğŸ¯ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡</h3>';
            personalizedHTML += '<p>Ø§ÛŒÙ† Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯:</p>';
            personalizedHTML += '<hr style="margin: 15px 0;">';
            
            students.forEach(student => {
                const studentResults = results.filter(result => 
                    result.studentId === student.nationalCode && 
                    teacherExams.some(exam => exam.id === result.examId)
                );
                
                if (studentResults.length > 0) {
                    const weakSubjects = identifyWeakSubjects(student.nationalCode, teacherExams, results);
                    
                    if (weakSubjects.length > 0) {
                        personalizedHTML += `
                            <div style="margin-bottom: 20px; padding: 15px; background: #e8f5e8; border-radius: 10px;">
                                <h4>${student.fullName}</h4>
                                <p><strong>Ø¢Ø²Ù…ÙˆÙ† ØªÙ…Ø±ÛŒÙ†ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:</strong> ØªÙ…Ø±ÛŒÙ† ${weakSubjects[0]}</p>
                                <p><strong>Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ:</strong> Ù…ØªÙˆØ³Ø·</p>
                                <p><strong>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª:</strong> Û±Û° Ø³ÙˆØ§Ù„</p>
                                <button class="action-btn success-btn" onclick="createPersonalizedExam('${student.nationalCode}', '${weakSubjects[0]}')">Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ†</button>
                            </div>
                        `;
                    } else {
                        personalizedHTML += `
                            <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                                <h4>${student.fullName}</h4>
                                <p>ğŸ‰ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± ØªÙ…Ø§Ù… Ø¯Ø±ÙˆØ³ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø·Ù„ÙˆØ¨ÛŒ Ø¯Ø§Ø±Ø¯</p>
                                <p><strong>Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯:</strong> Ø¢Ø²Ù…ÙˆÙ† Ú†Ø§Ù„Ø´ÛŒ Ø¨Ø§ Ø³Ø·Ø­ Ù¾ÛŒØ´Ø±ÙØªÙ‡</p>
                                <button class="action-btn secondary-btn" onclick="createChallengeExam('${student.nationalCode}')">Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ú†Ø§Ù„Ø´ÛŒ</button>
                            </div>
                        `;
                    }
                }
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª
            document.getElementById('resultsModalTitle').textContent = 'ğŸ¯ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡';
            document.getElementById('examResultsContent').innerHTML = personalizedHTML;
            showModal('examResultsModal');
        }

        // Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†
        function predictStudentSuccess() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const results = JSON.parse(localStorage.getItem('examResults')) || [];
            const exams = JSON.parse(localStorage.getItem('exams')) || [];
            const teacherExams = exams.filter(exam => exam.createdBy === currentTeacher.nationalCode);
            
            if (students.length === 0) {
                alert('ğŸ‘¥ Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                return;
            }
            
            let predictionHTML = '<h3>ğŸ”® Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</h3>';
            predictionHTML += '<p>Ø§ÛŒÙ† Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú¯Ø°Ø´ØªÙ‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ Ø§Ø³Øª:</p>';
            predictionHTML += '<hr style="margin: 15px 0;">';
            
            students.forEach(student => {
                const studentResults = results.filter(result => 
                    result.studentId === student.nationalCode && 
                    teacherExams.some(exam => exam.id === result.examId)
                );
                
                if (studentResults.length > 0) {
                    const average = studentResults.reduce((sum, result) => sum + result.percentage, 0) / studentResults.length;
                    const trend = calculatePerformanceTrend(studentResults);
                    const successProbability = calculateSuccessProbability(average, trend);
                    
                    predictionHTML += `
                        <div style="margin-bottom: 20px; padding: 15px; background: ${getPredictionColor(successProbability)}; border-radius: 10px;">
                            <h4>${student.fullName}</h4>
                            <p><strong>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù†Ù…Ø±Ø§Øª:</strong> ${average.toFixed(1)}%</p>
                            <p><strong>Ø±ÙˆÙ†Ø¯ Ø¹Ù…Ù„Ú©Ø±Ø¯:</strong> ${trend}</p>
                            <p><strong>Ø§Ø­ØªÙ…Ø§Ù„ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø¹Ø¯ÛŒ:</strong> ${successProbability}%</p>
                            <p><strong>ØªÙˆØµÛŒÙ‡:</strong> ${getSuccessRecommendation(successProbability)}</p>
                        </div>
                    `;
                } else {
                    predictionHTML += `
                        <div style="margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 10px;">
                            <h4>${student.fullName}</h4>
                            <p>ğŸ“­ Ø¯Ø§Ø¯Ù‡ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
                            <p><strong>ØªÙˆØµÛŒÙ‡:</strong> Ø´Ø±Ú©Øª Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡</p>
                        </div>
                    `;
                }
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒâ€ŒÙ‡Ø§
            document.getElementById('resultsModalTitle').textContent = 'ğŸ”® Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù…ÙˆÙÙ‚ÛŒØª';
            document.getElementById('examResultsContent').innerHTML = predictionHTML;
            showModal('examResultsModal');
        }

        // ØªØµØ­ÛŒØ­ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        function aiGrading() {
            alert('ğŸ“ Ø³ÛŒØ³ØªÙ… ØªØµØ­ÛŒØ­ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ\n\nØ§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯ Ùˆ Ø§Ù…Ú©Ø§Ù† ØªØµØ­ÛŒØ­ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØªØ´Ø±ÛŒØ­ÛŒ Ø±Ø§ ÙØ±Ø§Ù‡Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯.');
        }

        // Ù…Ø³ÛŒØ± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
        function learningPath() {
            alert('ğŸ—ºï¸ Ø³ÛŒØ³ØªÙ… Ù…Ø³ÛŒØ± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯\n\nØ§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯ Ùˆ Ù…Ø³ÛŒØ± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.');
        }

        // ========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ==========

        // ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        function generateAISampleQuestions(subject, level, count) {
            const questions = [];
            
            for (let i = 0; i < count; i++) {
                let questionText = '';
                let options = [];
                let correctAnswer = Math.floor(Math.random() * 4);
                
                // ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆØ¶ÙˆØ¹ Ùˆ Ø³Ø·Ø­
                switch(subject) {
                    case 'ÙØ§Ø±Ø³ÛŒ':
                        questionText = `Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡ ØµØ­ÛŒØ­ Ø§Ø³ØªØŸ (Ø³ÙˆØ§Ù„ ${i+1} ÙØ§Ø±Ø³ÛŒ ${level})`;
                        options = [
                            'Ú¯Ø²ÛŒÙ†Ù‡ Ø§ÙˆÙ„ Ù†Ù…ÙˆÙ†Ù‡',
                            'Ú¯Ø²ÛŒÙ†Ù‡ Ø¯ÙˆÙ… Ù†Ù…ÙˆÙ†Ù‡',
                            'Ú¯Ø²ÛŒÙ†Ù‡ Ø³ÙˆÙ… Ù†Ù…ÙˆÙ†Ù‡',
                            'Ú¯Ø²ÛŒÙ†Ù‡ Ú†Ù‡Ø§Ø±Ù… Ù†Ù…ÙˆÙ†Ù‡'
                        ];
                        break;
                    case 'Ø±ÛŒØ§Ø¶ÛŒ':
                        questionText = `Ø­Ø§ØµÙ„ Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ Ø²ÛŒØ± Ú†ÛŒØ³ØªØŸ (Ø³ÙˆØ§Ù„ ${i+1} Ø±ÛŒØ§Ø¶ÛŒ ${level})`;
                        options = [
                            'Ø¬ÙˆØ§Ø¨ Ø§ÙˆÙ„',
                            'Ø¬ÙˆØ§Ø¨ Ø¯ÙˆÙ…',
                            'Ø¬ÙˆØ§Ø¨ Ø³ÙˆÙ…',
                            'Ø¬ÙˆØ§Ø¨ Ú†Ù‡Ø§Ø±Ù…'
                        ];
                        break;
                    case 'Ø¹Ù„ÙˆÙ…':
                        questionText = `Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¹Ù„ÙˆÙ… ØµØ­ÛŒØ­ Ø§Ø³ØªØŸ (Ø³ÙˆØ§Ù„ ${i+1} Ø¹Ù„ÙˆÙ… ${level})`;
                        options = [
                            'Ù†Ø¸Ø±ÛŒÙ‡ Ø§ÙˆÙ„',
                            'Ù†Ø¸Ø±ÛŒÙ‡ Ø¯ÙˆÙ…',
                            'Ù†Ø¸Ø±ÛŒÙ‡ Ø³ÙˆÙ…',
                            'Ù†Ø¸Ø±ÛŒÙ‡ Ú†Ù‡Ø§Ø±Ù…'
                        ];
                        break;
                    default:
                        questionText = `Ø³ÙˆØ§Ù„ Ù†Ù…ÙˆÙ†Ù‡ ${i+1} Ø¯Ø± ${subject}`;
                        options = ['Ú¯Ø²ÛŒÙ†Ù‡ Û±', 'Ú¯Ø²ÛŒÙ†Ù‡ Û²', 'Ú¯Ø²ÛŒÙ†Ù‡ Û³', 'Ú¯Ø²ÛŒÙ†Ù‡ Û´'];
                }
                
                questions.push({
                    text: questionText,
                    options: options,
                    correctAnswer: correctAnswer
                });
            }
            
            return questions;
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆÙ†Ø¯ Ø¹Ù…Ù„Ú©Ø±Ø¯
        function calculatePerformanceTrend(results) {
            if (results.length < 2) return 'Ø«Ø§Ø¨Øª';
            
            const sortedResults = results.sort((a, b) => new Date(a.submitDate) - new Date(b.submitDate));
            const firstScore = sortedResults[0].percentage;
            const lastScore = sortedResults[sortedResults.length - 1].percentage;
            
            if (lastScore > firstScore + 5) return 'ğŸ“ˆ ØµØ¹ÙˆØ¯ÛŒ';
            if (lastScore < firstScore - 5) return 'ğŸ“‰ Ù†Ø²ÙˆÙ„ÛŒ';
            return 'â¡ï¸ Ø«Ø§Ø¨Øª';
        }

        // Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø±ÙˆØ³ Ø¶Ø¹ÛŒÙ
        function identifyWeakSubjects(studentId, teacherExams, allResults) {
            const studentResults = allResults.filter(result => result.studentId === studentId);
            const subjectScores = {};
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‡Ø± Ø¯Ø±Ø³
            teacherExams.forEach(exam => {
                const examResult = studentResults.find(result => result.examId === exam.id);
                if (examResult) {
                    if (!subjectScores[exam.subject]) {
                        subjectScores[exam.subject] = [];
                    }
                    subjectScores[exam.subject].push(examResult.percentage);
                }
            });
            
            // Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø±ÙˆØ³ Ø¨Ø§ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù…ØªØ± Ø§Ø² 60
            const weakSubjects = [];
            for (const subject in subjectScores) {
                const avg = subjectScores[subject].reduce((sum, score) => sum + score, 0) / subjectScores[subject].length;
                if (avg < 60) {
                    weakSubjects.push(subject);
                }
            }
            
            return weakSubjects;
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø­ØªÙ…Ø§Ù„ Ù…ÙˆÙÙ‚ÛŒØª
        function calculateSuccessProbability(average, trend) {
            let probability = average;
            
            if (trend.includes('ØµØ¹ÙˆØ¯ÛŒ')) probability += 10;
            if (trend.includes('Ù†Ø²ÙˆÙ„ÛŒ')) probability -= 10;
            
            return Math.max(0, Math.min(100, Math.round(probability)));
        }

        // Ø±Ù†Ú¯ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ
        function getPredictionColor(probability) {
            if (probability >= 80) return '#e8f5e8';
            if (probability >= 60) return '#fff3cd';
            return '#ffebee';
        }

        // ØªÙˆØµÛŒÙ‡ Ù…ÙˆÙÙ‚ÛŒØª
        function getSuccessRecommendation(probability) {
            if (probability >= 80) return 'Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø¹Ø§Ù„ÛŒØŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒØ¯';
            if (probability >= 60) return 'Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ…Ø±ÛŒÙ† Ø¨ÛŒØ´ØªØ±';
            return 'Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¬Ù‡ Ùˆ ØªÙ…Ø±ÛŒÙ† ÙØ´Ø±Ø¯Ù‡';
        }

        // Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
        function createPersonalizedExam(studentId, subject) {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const student = students.find(s => s.nationalCode === studentId);
            
            if (student) {
                // Ù¾Ø± Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
                document.getElementById('examTitle').value = `Ø¢Ø²Ù…ÙˆÙ† ØªÙ…Ø±ÛŒÙ†ÛŒ ${subject} - ${student.fullName}`;
                document.getElementById('examSubject').value = subject;
                document.getElementById('examLevel').value = 'intermediate';
                document.getElementById('examDescription').value = `Ø¢Ø²Ù…ÙˆÙ† Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ${student.fullName} Ø¬Ù‡Øª Ø¨Ù‡Ø¨ÙˆØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø± ${subject}`;
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø³ÙˆØ§Ù„Ø§Øª Ù‚Ø¨Ù„ÛŒ
                questionsCount = 0;
                document.getElementById('questionsContainer').innerHTML = '';
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³ÙˆØ§Ù„Ø§Øª Ù†Ù…ÙˆÙ†Ù‡
                addQuestion();
                addQuestion();
                addQuestion();
                
                closeModal('examResultsModal');
                showModal('createExamModal');
                showSuccessMessage(`âœ… ÙØ±Ù… Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø±Ø§ÛŒ ${student.fullName} Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯`);
            }
        }

        // Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ú†Ø§Ù„Ø´ÛŒ
        function createChallengeExam(studentId) {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const student = students.find(s => s.nationalCode === studentId);
            
            if (student) {
                // Ù¾Ø± Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ú†Ø§Ù„Ø´ÛŒ
                document.getElementById('examTitle').value = `Ø¢Ø²Ù…ÙˆÙ† Ú†Ø§Ù„Ø´ÛŒ - ${student.fullName}`;
                document.getElementById('examSubject').value = 'ÙØ§Ø±Ø³ÛŒ';
                document.getElementById('examLevel').value = 'advanced';
                document.getElementById('examDescription').value = `Ø¢Ø²Ù…ÙˆÙ† Ú†Ø§Ù„Ø´ÛŒ Ø¨Ø±Ø§ÛŒ ${student.fullName} Ø¬Ù‡Øª Ø³Ù†Ø¬Ø´ Ø³Ø·Ø­ Ù¾ÛŒØ´Ø±ÙØªÙ‡`;
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø³ÙˆØ§Ù„Ø§Øª Ù‚Ø¨Ù„ÛŒ
                questionsCount = 0;
                document.getElementById('questionsContainer').innerHTML = '';
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³ÙˆØ§Ù„Ø§Øª Ø¨ÛŒØ´ØªØ±
                for (let i = 0; i < 5; i++) {
                    addQuestion();
                }
                
                closeModal('examResultsModal');
                showModal('createExamModal');
                showSuccessMessage(`âœ… ÙØ±Ù… Ø¢Ø²Ù…ÙˆÙ† Ú†Ø§Ù„Ø´ÛŒ Ø¨Ø±Ø§ÛŒ ${student.fullName} Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯`);
            }
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
        function showSuccessMessage(message) {
            // Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù„Ù…Ø§Ù† Ù¾ÛŒØ§Ù…
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.textContent = message;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØµÙØ­Ù‡
            document.querySelector('.teacher-container').insertBefore(messageDiv, document.querySelector('.stats-cards'));
            
            // Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ø² Û³ Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§
        function showError(message) {
            alert(`âŒ ${message}`);
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…
        function logout() {
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
                localStorage.removeItem('currentTeacher');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>